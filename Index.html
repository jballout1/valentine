<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Will you be my valentine?</title>
  <style>
    :root{
      --bg1:#ffdde1;
      --bg2:#ee9ca7;
      --card:rgba(255,255,255,.75);
      --text:#1f1f1f;

      --safe-top: env(safe-area-inset-top, 0px);
      --safe-right: env(safe-area-inset-right, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --safe-left: env(safe-area-inset-left, 0px);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      background:radial-gradient(circle at top,var(--bg1),var(--bg2));
      overflow:hidden;
      padding: calc(12px + var(--safe-top)) calc(12px + var(--safe-right))
               calc(12px + var(--safe-bottom)) calc(12px + var(--safe-left));
      -webkit-tap-highlight-color: transparent;
    }

    .card{
      width:min(680px,92vw);
      padding:28px 22px 24px;
      border-radius:18px;
      background:var(--card);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      box-shadow:0 10px 30px rgba(0,0,0,.12);
      text-align:center;
      position:relative;
      z-index:1;
    }

    h1{
      margin:0 0 18px;
      font-size:clamp(28px,5vw,44px);
    }

    .buttons{
      margin-top:18px;
      display:flex;
      gap:14px;
      justify-content:center;
      flex-wrap:wrap;
      align-items:center;
    }

    button{
      border:none;
      padding:12px 22px;
      border-radius:999px;
      font-size:18px;
      cursor:pointer;
      transition:transform .08s ease, box-shadow .12s ease;
      user-select:none;
      -webkit-user-select:none;
      -webkit-touch-callout:none;
      touch-action: manipulation;
    }
    button:active{ transform:scale(.97); }

    #yesBtn{
      background:#22c55e;
      color:#fff;
      box-shadow:0 8px 18px rgba(34,197,94,.35);
      position:relative;
      z-index:2;
    }

    /* Placeholder slot to keep layout (the real No button floats above) */
    #noSlot{
      display:inline-block;
      padding:12px 22px;
      border-radius:999px;
      font-size:18px;
      opacity:0;
      pointer-events:none;
    }

    /* Real "No" button (body-level, viewport based) */
    #noBtn{
      background:#ef4444;
      color:#fff;
      box-shadow:0 8px 18px rgba(239,68,68,.32);
      position:fixed;
      left:50%;
      top:60%;
      transform:translate(-50%,-50%);
      z-index:9998;

      /* IMPORTANT: allows us to intercept tap reliably on iOS */
      touch-action:none;
      -webkit-user-select:none;
      -webkit-touch-callout:none;
    }

    /* Heart */
    .heartWrap{
      margin-top:18px;
      min-height:120px;
      display:grid;
      place-items:center;
    }
    .heart{
      width:90px;height:90px;
      position:relative;
      transform:rotate(-45deg);
      background:#ff2d55;
      animation:pop 550ms ease-out, beat 900ms infinite ease-in-out;
      box-shadow:0 12px 25px rgba(255,45,85,.35);
    }
    .heart::before,.heart::after{
      content:"";
      width:90px;height:90px;
      position:absolute;
      border-radius:50%;
      background:#ff2d55;
    }
    .heart::before{ top:-45px; left:0; }
    .heart::after{ left:45px; top:0; }

    @keyframes pop{
      0%{ transform:rotate(-45deg) scale(.2); opacity:0; }
      100%{ transform:rotate(-45deg) scale(1); opacity:1; }
    }
    @keyframes beat{
      0%,100%{ transform:rotate(-45deg) scale(1); }
      50%{ transform:rotate(-45deg) scale(1.08); }
    }

    /* Warning */
    .warning{
      margin-top:16px;
      display:none;
      gap:12px;
      align-items:center;
      justify-content:center;
      flex-wrap:wrap;
      padding:14px;
      border-radius:14px;
      background:rgba(255,255,255,.85);
      border:1px solid rgba(0,0,0,.06);
    }
    .warning img{
      width:120px;
      border-radius:12px;
      box-shadow:0 8px 18px rgba(0,0,0,.15);
    }
    .warning p{
      margin:0;
      font-size:16px;
      max-width:320px;
      line-height:1.25rem;
    }

    .hint{
      margin-top:10px;
      opacity:.75;
      font-size:13px;
    }

    /* Confetti */
    #confetti{
      position:fixed;
      inset:0;
      width:100%;
      height:100%;
      pointer-events:none;
      z-index:9999;
    }
  </style>
</head>
<body>
  <canvas id="confetti"></canvas>

  <main class="card">
    <h1>Will you be my valentine?</h1>

    <div class="buttons">
      <button id="yesBtn">Yes üíò</button>
      <span id="noSlot">No üôÖ‚Äç‚ôÄÔ∏è</span>
    </div>

    <div class="heartWrap" id="heartWrap" aria-live="polite"></div>

    <div class="warning" id="warning">
      <img id="warningImg" alt="Funny warning" />
      <p><strong>Hey!</strong> Stop fooling with me üò§<br/>Just press <strong>Yes</strong> already üòÖ</p>
    </div>

    <div class="hint" id="hint">Tap ‚ÄúNo‚Äù‚Ä¶ if you can üòè</div>
  </main>

  <!-- Real No button -->
  <button id="noBtn" aria-label="No">No üôÖ‚Äç‚ôÄÔ∏è</button>

  <script>
    const yesBtn = document.getElementById("yesBtn");
    const noBtn = document.getElementById("noBtn");
    const noSlot = document.getElementById("noSlot");

    const heartWrap = document.getElementById("heartWrap");
    const warning = document.getElementById("warning");
    const warningImg = document.getElementById("warningImg");
    const hint = document.getElementById("hint");

    let noAttempts = 0;
    let accepted = false;

    // Offline funny image
    const svg = `
      <svg xmlns="http://www.w3.org/2000/svg" width="600" height="420">
        <defs>
          <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0" stop-color="#ffe29f"/>
            <stop offset="1" stop-color="#ffa99f"/>
          </linearGradient>
        </defs>
        <rect width="100%" height="100%" rx="30" fill="url(#g)"/>
        <text x="50%" y="36%" text-anchor="middle" font-family="Arial, sans-serif" font-size="52" fill="#1f1f1f">üò§</text>
        <text x="50%" y="56%" text-anchor="middle" font-family="Arial, sans-serif" font-size="34" fill="#1f1f1f">
          Don‚Äôt play with me
        </text>
        <text x="50%" y="72%" text-anchor="middle" font-family="Arial, sans-serif" font-size="26" fill="#1f1f1f" opacity="0.85">
          Press YES üíò
        </text>
      </svg>
    `.trim();
    warningImg.src = "data:image/svg+xml;charset=utf-8," + encodeURIComponent(svg);

    function rand(min, max){ return Math.random() * (max - min) + min; }
    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

    function getSafeArea(){
      const styles = getComputedStyle(document.documentElement);
      const top = parseFloat(styles.getPropertyValue("--safe-top")) || 0;
      const right = parseFloat(styles.getPropertyValue("--safe-right")) || 0;
      const bottom = parseFloat(styles.getPropertyValue("--safe-bottom")) || 0;
      const left = parseFloat(styles.getPropertyValue("--safe-left")) || 0;
      return { top, right, bottom, left };
    }

    function snapNoToSlot(){
      const r = noSlot.getBoundingClientRect();
      noBtn.style.left = (r.left + r.width/2) + "px";
      noBtn.style.top  = (r.top + r.height/2) + "px";
      noBtn.style.transform = "translate(-50%, -50%)";
    }

    function moveNoButton(){
      if (accepted) return;

      noAttempts++;

      const padding = 12;
      const safe = getSafeArea();
      const r = noBtn.getBoundingClientRect();

      const vw = window.innerWidth;
      const vh = window.innerHeight;

      const minLeft = padding + safe.left + r.width/2;
      const minTop  = padding + safe.top + r.height/2;
      const maxLeft = vw - padding - safe.right - r.width/2;
      const maxTop  = vh - padding - safe.bottom - r.height/2;

      const newLeft = rand(minLeft, maxLeft);
      const newTop  = rand(minTop, maxTop);

      noBtn.style.left = clamp(newLeft, minLeft, maxLeft) + "px";
      noBtn.style.top  = clamp(newTop, minTop, maxTop) + "px";
      noBtn.style.transform = "translate(-50%, -50%)";

      if (noAttempts > 3){
        warning.style.display = "flex";
        hint.textContent = "Okay okay‚Ä¶ no more games üòÑ";
      }
    }

    function showHeart(){
      heartWrap.innerHTML = "";
      const heart = document.createElement("div");
      heart.className = "heart";
      heartWrap.appendChild(heart);
    }

    // ---- Confetti ----
    const confettiCanvas = document.getElementById("confetti");
    const ctx = confettiCanvas.getContext("2d", { alpha: true });

    function resizeCanvas(){
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      confettiCanvas.width = Math.floor(window.innerWidth * dpr);
      confettiCanvas.height = Math.floor(window.innerHeight * dpr);
      confettiCanvas.style.width = window.innerWidth + "px";
      confettiCanvas.style.height = window.innerHeight + "px";
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }

    let confettiPieces = [];
    let confettiRunning = false;

    function makeConfettiBurst(x, y){
      const count = 150;
      const gravity = 0.16;
      confettiPieces = [];
      for (let i=0;i<count;i++){
        const size = rand(5, 10);
        confettiPieces.push({
          x, y,
          w: size,
          h: rand(6, 14),
          vx: rand(-6.8, 6.8),
          vy: rand(-11, -4),
          rot: rand(0, Math.PI * 2),
          vr: rand(-0.22, 0.22),
          life: rand(75, 130),
          color: `hsl(${Math.floor(rand(0, 360))} 90% 60%)`,
          gravity
        });
      }
    }

    function drawConfetti(){
      ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);

      for (const p of confettiPieces){
        p.vy += p.gravity;
        p.x += p.vx;
        p.y += p.vy;
        p.rot += p.vr;
        p.life -= 1;

        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rot);
        ctx.fillStyle = p.color;
        ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
        ctx.restore();
      }

      confettiPieces = confettiPieces.filter(p => p.life > 0 && p.y < window.innerHeight + 60);

      if (confettiPieces.length){
        requestAnimationFrame(drawConfetti);
      } else {
        confettiRunning = false;
        ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);
      }
    }

    function confettiBurstFromButton(){
      const r = yesBtn.getBoundingClientRect();
      makeConfettiBurst(r.left + r.width/2, r.top + r.height/2);
      if (!confettiRunning){
        confettiRunning = true;
        requestAnimationFrame(drawConfetti);
      }
    }
    // ------------------

    yesBtn.addEventListener("click", () => {
      accepted = true;
      warning.style.display = "none";
      hint.textContent = "YAAAAY üíñ";
      showHeart();
      confettiBurstFromButton();

      noBtn.disabled = true;
      noBtn.style.opacity = "0.6";
      noBtn.style.cursor = "not-allowed";
    });

    // ‚úÖ Most reliable trick on iPhone / file:// / in-app browsers:
    // Intercept the tap in CAPTURE phase, prevent it, then move the button.
    function interceptAndRun(e){
      if (accepted) return;
      if (e && e.cancelable) e.preventDefault();
      e.stopPropagation();
      if (e.stopImmediatePropagation) e.stopImmediatePropagation();
      moveNoButton();
      return false;
    }

    // Capture listeners (works across iOS Safari/Chrome and file://)
    noBtn.addEventListener("touchstart", interceptAndRun, { passive: false, capture: true });
    noBtn.addEventListener("pointerdown", interceptAndRun, { capture: true });
    noBtn.addEventListener("mousedown", interceptAndRun, { capture: true });
    noBtn.addEventListener("click", interceptAndRun, { capture: true });

    // init
    resizeCanvas();
    requestAnimationFrame(() => requestAnimationFrame(snapNoToSlot));

    window.addEventListener("resize", () => {
      resizeCanvas();
      if (!accepted && noAttempts === 0) snapNoToSlot();
    });
    window.addEventListener("orientationchange", () => {
      setTimeout(() => {
        resizeCanvas();
        if (!accepted && noAttempts === 0) snapNoToSlot();
      }, 250);
    });
  </script>
</body>
</html>
